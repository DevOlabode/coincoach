<% layout('layout/boilerplate') %>

<style>
  .btn {
    padding: 0.5rem 1rem;
    border-radius: 4px;
    text-decoration: none;
    display: inline-block;
    border: none;
    cursor: pointer;
    font-size: 0.9rem;
  }

  .btn-primary {
    background: #0066cc;
    color: white;
  }

  .btn-primary:hover {
    background: #0052a3;
  }

  .btn-success {
    background: #28a745;
    color: white;
  }

  .btn-success:hover {
    background: #218838;
  }

  .btn-secondary {
    background: #6c757d;
    color: white;
  }

  .btn-secondary:hover {
    background: #5a6268;
  }

  .transaction-card {
    background: #fff;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: box-shadow 0.2s;
  }

  .transaction-card:hover {
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  }

  .transaction-card h3 {
    margin-top: 0;
    margin-bottom: 0.75rem;
  }

  .transaction-card a {
    color: #0066cc;
    text-decoration: none;
  }

  .transaction-card a:hover {
    text-decoration: underline;
  }

  .transaction-card ul {
    list-style: none;
    padding-left: 0;
    margin-bottom: 0;
  }

  .transaction-card li {
    padding: 0.25rem 0;
  }

  .badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.85rem;
    font-weight: normal;
  }

  .badge-income {
    background: #d4edda;
    color: #155724;
  }

  .badge-expense {
    background: #f8d7da;
    color: #721c24;
  }

  .badge-recurring {
    background: #d1ecf1;
    color: #0c5460;
  }
</style>

<div style="max-width: 1200px; margin: 0 auto; padding: 2rem;">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h2>All Transactions</h2>
    <div>
      <a href="/insights" class="btn btn-primary" style="margin-right: 0.5rem;">ðŸ“Š View Insights</a>
      
      <!-- Export Dropdown -->
      <div class="btn-group" style="display: inline-block; position: relative; margin-right: 0.5rem;">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="exportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
          ðŸ“¥ Export
        </button>
        <ul class="dropdown-menu" aria-labelledby="exportDropdown">
          <li><a class="dropdown-item" href="/export/excel">ðŸ“Š Export to Excel</a></li>
          <li><a class="dropdown-item" href="/export/csv">ðŸ“„ Export to CSV</a></li>
          <li><a class="dropdown-item" href="/export/google-sheets">ðŸ“— Export for Google Sheets</a></li>
        </ul>
      </div>
      
      <a href="/transactions/new" class="btn btn-success" style="margin-right: 0.5rem;">+ Add Transaction</a>
      <a href="/transactions/bulk-upload" class="btn btn-secondary">ðŸ“¤ Bulk Upload</a>
    </div>
  </div>
  </div>

  <% if(transactions.length === 0){ %>
    <div class="card" style="background: #fff; padding: 3rem; border-radius: 8px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
      <h4 style="margin-bottom: 1rem;">No Transactions Added</h4>
      <p style="color: #6c757d; margin-bottom: 1.5rem;">Get started by adding your first transaction or uploading a CSV/JSON file.</p>
      <div>
        <a href="/transactions/new" class="btn btn-primary" style="margin-right: 0.5rem;">Add Transaction</a>
        <a href="/transactions/bulk-upload" class="btn btn-secondary">Bulk Upload</a>
      </div>
    </div>
  <% }else{ %>
    <div style="margin-bottom: 1.5rem; padding: 0.75rem; background: #f8f9fa; border-radius: 4px;">
      <span>Showing <strong><%= count %></strong> transaction<%= count !== 1 ? 's' : '' %></span>
    </div>
    <% for(let transaction of transactions){ %>
      <div class="transaction-card">
        <h3>
          <a href="/transactions/<%= transaction._id %>"><%= transaction.name %></a>
        </h3>
        <ul>
          <li><b>Type:</b> 
            <span class="badge <%= transaction.type === 'income' ? 'badge-income' : 'badge-expense' %>">
              <%= transaction.type %>
            </span>
          </li>
          <li><b>Category:</b> <%= transaction.category || 'N/A' %></li>
          <li><b>Amount:</b> $<%= transaction.amount?.toLocaleString() || '0' %> <%= transaction.currency || 'CAD' %></li>
          <li><b>Date:</b> <%= transaction.date ? new Date(transaction.date).toLocaleDateString() : 'N/A' %></li>
          <% if(transaction.description){ %>
          <li><b>Description:</b> <%= transaction.description %></li>
          <% } %>
          <li><b>Input Method:</b> <%= transaction.inputMethod || 'manual' %></li>
          <% if(transaction.recurring){ %>
          <li><b>Recurring:</b> 
            <span class="badge badge-recurring">
              <%= transaction.recurring ? 'Yes' : 'No' %>
              <% if(transaction.recurrence){ %> (<%= transaction.recurrence %>)<% } %>
            </span>
          </li>
          <% } %>
        </ul>
      </div>
    <% } %>
  <% } %>
</div>
    